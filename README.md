# フルスクラッチ GUI 入門

# 車輪の再発明という大罪

プログラミングの原理原則の一つに「車輪の再発明をするな」があります。

部品の再利用ができるのがプログラミングが発展してきた理由であるからです。

この本は、そういった原則を当たり前のように破ります。

真面目な方はこの本を閉じることをおすすめします。
この本は車輪の再発明のためのガイドであり、昏倒するに違いありません。

# フルスクラッチ GUI の原罪

さて、フルスクラッチ GUI を作るにあたって、一つ注意点があります。

おそらく、あなたはブラウザネイティブの form 要素を再実装することになるでしょう。
それを実装した瞬間に、アクセシビリティは間違いなく大きく損なわれます。

キーボード操作が可能ですか？
tab でフォーカスできますか？
フォーカス時のアウトラインが表示されますか？
ESC でキャンセルできますか？
音声読み上げでは「ボタン」要素であることが明示されますが、div でボタン風の見た目をこしらえても、
要素についての情報は失われてしまいます。

ボタンは button 要素で実装するのが基本です。
div 要素でも svg でもありません。

しかし、ここから先は当然のようにアクセシビリティが損なわれる世界です。
場合によっては、スクラッチではどうしてもネイティブのアクセシビリティに至らないことがあります。

# 作ってみようよ

ここから実装を試みていきますが、実力に自信のある方はまず、ここから先を読まないことをおすすめします。

というのも、自分のやり方、アイデアで実装してみたくないですか？
あくまでここから先は、筆者 hashrock の実装の一案に過ぎません。

React でも Vue でも Angular でも構いません。まずは自分で実装を試みて、
それからここから先を読んだほうが 10 倍楽しめることでしょう。
自分のアイデアをブラウザというキャンバスで試してみませんか？
その情熱こそが、複雑 GUI が人を引きつける第一のポイントです。

# select 要素を自作してみよう

## トレースもとを観察しよう

トレース元のコンポーネントを隣に置きましょう。

遷移を図示すると下記のようになります。

## モックしよう

開発順序は人によるかとは思いますが、私は書きながら設計を考えたいので、まずモックを選択します。
一番難しそうな状況の View を先に作ってしまいます。

まずは細かい挙動はおいておいて、開いた状態のコンポーネントをモックします。

v-if などで非表示にすることでこれらの挙動を再現できます。

今回の肝はフロートする options で、`position: absolute`が必要になりそうです。

## オープン・クローズの挙動をつけよう

select をクリックすることでトグルするようにしましょう。

## キーボード操作に対応しよう

アクセシビリティの確保において、キーボード操作への対応は重要です。
併せて、フォーカス時の挙動についても再確認しておきましょう。

まず最初に tabindex をつけるところからです。

## WAI-ARIA について

今回、時間的な余裕がなく、WAI-ARIA にきちんと対応したコンポーネントを紹介することができませんでした。
理想を言えばスクリーンリーダーに完全対応したコンポーネントを作りたかったところですが、
そのようなコンポーネントは、そもそもの select 要素をそのまま使うだけで良いです。

無駄に自作しない、というのも大事になってくるでしょう。
といいつつ、１章まるごと無駄に自作してしまいました。

しっかりしたコンポーネントを作りたい場合は、下記のサンプル実装を参考にしてください。

https://w3c.github.io/aria-practices/examples/listbox/listbox-collapsible.html
